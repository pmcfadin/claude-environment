---
description: Scan installed components and regenerate ~/.claude/CLAUDE.md
allowed-tools: Read, Glob, Grep, Bash(ls *), Bash(cat *), Bash(readlink *), Write
---

# Refresh CLAUDE.md

Scan all installed skills, commands, agents, hooks, and scripts in `~/.claude/`, then generate or update `~/.claude/CLAUDE.md` with a concise inventory.

## Phase 1: Inventory

Scan the following locations and extract `name` and `description` from YAML frontmatter where available.

### 1a. Commands

```bash
ls ~/.claude/commands/*.md 2>/dev/null
```

For each `.md` file found, read the YAML frontmatter and extract the `description` field. The command name is the filename without the `.md` extension, prefixed with `/`.

### 1b. Agents

```bash
ls ~/.claude/agents/*.md 2>/dev/null
```

For each agent file, read the YAML frontmatter and extract the `name` and `description` fields.

### 1c. Skills

```bash
ls ~/.claude/skills/*/SKILL.md 2>/dev/null
```

For each SKILL.md, read the YAML frontmatter and extract the `name` and `description` fields.

### 1d. Hooks

Read `~/.claude/settings.json` and extract the `hooks` object. For each hook type (e.g., `Stop`, `SessionStart`, `PreToolUse`), note the type and infer a brief purpose from the command string.

### 1e. Scripts

```bash
ls ~/.claude/orchestrator/scripts/*.sh 2>/dev/null
```

Note these for reference but they don't need their own table — they support the hooks and commands above.

## Phase 2: Check Existing CLAUDE.md

Read `~/.claude/CLAUDE.md` if it exists.

1. **If the file contains `<!-- USER CUSTOM START -->` and `<!-- USER CUSTOM END -->` markers**: Extract the content between those markers and preserve it for Phase 3.
2. **If the file exists but has no markers**: Treat the entire file content as user custom content to preserve.
3. **If the file does not exist**: Use a starter template for the user custom section.

## Phase 3: Generate CLAUDE.md

Build a concise (<300 line) `CLAUDE.md` with the following structure. Use the exact marker comments shown below.

```markdown
# Claude Code - Personal Configuration

<!-- GENERATED START -->
<!-- Auto-generated by /refresh-claude-md on YYYY-MM-DD -->

## Available Commands
| Command | Description |
|---------|-------------|
| `/command-name` | description from frontmatter |

## Available Agents
| Agent | Role |
|-------|------|
| agent-name | description from frontmatter |

## Installed Skills
| Skill | Description |
|-------|-------------|
| skill-name | description from frontmatter |

## Active Hooks
- **HookType**: brief purpose inferred from command

## Workflow Quick Reference
- Synthesize 3-5 bullets from the installed components
- Focus on the most common user-facing actions
- Example: "Plan a feature: `/plan-epic [description]`"

<!-- GENERATED END -->

<!-- USER CUSTOM START -->
## Personal Preferences
<!-- Add your preferences, project conventions, or notes here — preserved across refreshes -->
<!-- USER CUSTOM END -->
```

### Generation rules

- Keep it **under 300 lines total**
- Descriptions should be **one line each**, truncated if necessary
- Skip empty sections (e.g., if no agents are installed, omit the Agents table)
- Follow symlinks when reading files
- Do **not** include secrets, API keys, or sensitive data
- The date in the auto-generated comment should be today's date

## Phase 4: Write & Confirm

1. Write the generated content to `~/.claude/CLAUDE.md`
2. Display a summary to the user:
   - Number of commands found
   - Number of agents found
   - Number of skills found
   - Number of hooks found
   - Whether user custom content was preserved

## Rules

- **Idempotent**: Running this command multiple times produces the same result (given the same installed components)
- **Under 300 lines**: The generated file must be concise and scannable
- **Preserve user content**: Never overwrite content between USER CUSTOM markers
- **Follow symlinks**: When scanning directories, resolve symlinks to find actual files
- **No secrets**: Never include API keys, tokens, or credentials in the generated file
- **Graceful degradation**: If a directory doesn't exist or is empty, skip it silently
