---
description: Scan project .claude/ components and regenerate CLAUDE.md
allowed-tools: Read, Glob, Grep, Bash(ls *), Write
---

# Refresh CLAUDE.md

Scan all installed commands and agents in the project's `.claude/` directory, then generate or update the project's `CLAUDE.md` with a concise inventory.

## Phase 1: Inventory

Scan the following project-local locations and extract `name` and `description` from YAML frontmatter where available.

### 1a. Commands

```
Glob .claude/commands/*.md
```

For each `.md` file found, read the YAML frontmatter and extract the `description` field. The command name is the filename without the `.md` extension, prefixed with `/`.

### 1b. Agents

```
Glob .claude/agents/*.md
```

For each agent file, read the YAML frontmatter and extract the `name` and `description` fields.

### 1c. Settings

Read `.claude/settings.json` and note the configured permissions.

## Phase 2: Check Existing CLAUDE.md

Read `CLAUDE.md` if it exists in the project root.

1. **If the file contains `<!-- USER CUSTOM START -->` and `<!-- USER CUSTOM END -->` markers**: Extract the content between those markers and preserve it for Phase 3.
2. **If the file exists but has no markers**: Treat the entire file content as user custom content to preserve.
3. **If the file does not exist**: Use a starter template for the user custom section.

## Phase 3: Generate CLAUDE.md

Build a concise (<300 line) `CLAUDE.md` with the following structure:

```markdown
# Project Configuration

<!-- GENERATED START -->
<!-- Auto-generated by /refresh-claude-md on YYYY-MM-DD -->

## Available Commands
| Command | Description |
|---------|-------------|
| `/command-name` | description from frontmatter |

## Available Agents
| Agent | Role |
|-------|------|
| agent-name | description from frontmatter |

## Workflow Quick Reference
- Plan a feature: `/plan-epic [description]`
- Execute an epic: `/run-epic [issue-number]`
- Check progress: `/epic-status [issue-number]`

<!-- GENERATED END -->

<!-- USER CUSTOM START -->
## Project Conventions
<!-- Add your preferences, project conventions, tech stack notes here â€” preserved across refreshes -->
<!-- USER CUSTOM END -->
```

### Generation rules

- Keep it **under 300 lines total**
- Descriptions should be **one line each**, truncated if necessary
- Skip empty sections (e.g., if no agents are installed, omit the Agents table)
- Do **not** include secrets, API keys, or sensitive data
- The date in the auto-generated comment should be today's date

## Phase 4: Write & Confirm

1. Write the generated content to `CLAUDE.md` in the project root
2. Display a summary to the user:
   - Number of commands found
   - Number of agents found
   - Whether user custom content was preserved

## Rules

- **Idempotent**: Running this command multiple times produces the same result
- **Under 300 lines**: The generated file must be concise and scannable
- **Preserve user content**: Never overwrite content between USER CUSTOM markers
- **No secrets**: Never include API keys, tokens, or credentials
- **Graceful degradation**: If a directory doesn't exist or is empty, skip it silently
